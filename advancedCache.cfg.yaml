cache:
  env: "dev"
  enabled: true

  logs:
    level: "info"
    stats: true   # Should the statistic like num evictions, refreshes, rps, memory usage and so on be written in /std/out?

  runtime:
    gomaxprocs: 0

  api:
    where: ":8020"

  upstream:
    cluster:
      backends:
        - url: "https://seo-master.lux.kube.xbet.lan"  # Backend (example of full qualified url: http://localhost:8020)
          rate: 250000                                 # Rate limiting reqs to backend per second.
          timeout: "5m"                                # Timeout for requests to backend.
        - url: "http://localhost:8080"                 # Backend (example of full qualified url: http://localhost:8020)
          rate: 250000                                 # Rate limiting reqs to backend per second.
          timeout: "5m"

  data:
    dump:
      enabled: false
      dump_dir: "public/dump" # dump dir.
      dump_name: "cache.dump" # dump name
      crc32_control_sum: true
      max_versions: 3
      gzip: false
    mock:
      enabled: false
      length: 1000000

  storage:
    size: 34359738368 # 32GB of maximum allowed memory for the in-memory cache (in bytes).

  eviction:
    enabled: true
    threshold: 0.95    # Trigger eviction when cache memory usage exceeds 90% of its configured limit.

  refresh:
    enabled: true     # Should this be run?
    ttl: "24h"        # Will be used be default with 200 status code.
    rate: 80          # Rate limiting reqs to backend per second.
    scan_rate: 10000  # Rate limiting of num scans items per second.
    beta: 0.4         # Controls randomness in refresh timing to avoid thundering herd (from 0 to 1).
    coefficient: 0.5  # Starts attempts to renew data after TTL*coefficient=50% (12h if whole TTL is 24h)

  forceGC:
    enabled: true
    interval: "10s"

  metrics:
    enabled: true

  k8s:
    probe:
      timeout: "5s"

  rules:
    /api/v2/pagedata:
      refresh:
        enabled: true
        ttl: "12h"
        beta: 0.4         # Controls randomness in refresh timing to avoid thundering herd (from 0 to 1).
        coefficient: 0.5  # Starts attempts to renew data after TTL*coefficient=50% (12h if whole TTL is 24h)
      cache_key:
        query: # Match query parameters by prefix.
          - project[id]
          - domain
          - language
          - choice
          - timezone
        headers:
          - Accept-Encoding
      cache_value:
        headers:
          - Content-Type
          - Content-Encoding
          - Cache-Control
          - Vary
          - Strict-Transport-Security
          - Content-Length
          - Cache-Control
          - X-Content-Digest
          - Age

    /api/v1/pagecontent:
      cache_key:
        query: # Match query parameters by prefix.
          - project[id]
          - domain
          - language
          - choice
          - timezone
        headers:
          - Accept-Encoding
      cache_value:
        headers:
          - Content-Type
          - Content-Encoding
          - Cache-Control
          - Vary
          - Strict-Transport-Security
          - Content-Length
          - Cache-Control
          - X-Content-Digest
          - Age